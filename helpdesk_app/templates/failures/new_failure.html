{% extends 'base.html' %}
{% load static %}

{% load auth_extras %}
{% load crispy_forms_tags %}


{% block page_content %}

{% block title %}

<h1 class="h3 mb-0 text-gray-800"> Καταχώρηση Νέας Βλάβης </h1>

{% endblock %}

{% block content %}
<!-- Content Row -->
<div class="row">

    <!-- New Breakdow Form -->
    <div class="col-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary"> Στοιχεία νέας βλάβης </h6>
            </div>
            <div class="card-body border-left-primary">
                <form id="new_failure_form" method="POST" action="{% url 'failures_all' %}" enctype="multipart/form-data" onsubmit="return checkMeans()">
                    {% csrf_token %}
                    <div class="form-group row">
                        <div class="col-12 uppercase-input">
                            <label class="field-label{% if form.description.field.required %} field-required{% endif %}"
                                for="{{ form.description.name }}">{{ form.description.label }}:
                            </label>
                            {% if form.description.errors %}<span
                                class="field-error">{{ form.description.errors }}</span>
                            {% endif %}
                                {% comment %} {{form.description}} {% endcomment %}
                                {% comment %} write this, which is exactly what {{form.description}} renders, 
                                but now we can edit the resize property of the textarea{% endcomment %}
                                <textarea name="description" cols="40" rows="4" style="resize: none;"
                                    class="form-control form-control-section" placeholder="---" id="id_description"></textarea>
                            {% if form.description.help_text %}
                                <span class="field-helptext">{{ form.description.help_text|safe }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="form-group row">

                        {% comment %} Select means {% endcomment %}
                        <div class="col-3">
                            <label class="field-label{% if form.means.field.required %} field-required{% endif %}"
                                for="{{ form.means.name }}">{{ form.means.label }}:</label>
                            {% if form.means.errors %}
                            <span class="field-error">{{ form.means.errors }}</span>
                            {% endif %}
                            <select name="means" id="id_means_new_failure" class="selectpicker" data-live-search="true"
                                data-width="100%" data-actions-box="true" data-actions-box="true">
                                <option selected disabled hidden style='display: none' value=''></option>
                                {% for choice in form.means %}
                                {{ choice }}
                                {% endfor %}
                            </select>
                            {% if form.means.errors %}
                            <span class="field-helptext">{{ form.means.help_text|safe }}</span>
                            {% endif %}
                        </div>

                        {% comment %} Select failure type {% endcomment %}
                        <div class="col-3">
                            <label class= "field-label field-required"
                                for="{{ form.failure_type.name }}">{{ form.failure_type.label }}:</label>
                            {% if form.failure_type.errors %}
                            <span class="field-error">{{ form.failure_type.errors }}</span>
                            {% endif %}
                            <select name="failure_type" id="id_failure_type" class="selectpicker" data-live-search="true"
                                data-width="100%" data-actions-box="true" data-actions-box="true">
                            </select>
                            {% if form.failure_type.errors %}
                            <span class="field-helptext">{{ form.failure_type.help_text|safe }}</span>
                            {% endif %}
                        </div>

                        {% comment %} Select unit {% endcomment %}
                        <div class="col-3">
                            <label class="field-label{% if form.unit.field.required %} field-required{% endif %}"
                                for="{{ form.unit.name }}">{{ "Επηρεαζόμενος Κόμβος" }}:</label>
                            {% if form.unit.errors %}
                            <span class="field-error">{{ form.unit.errors }}</span>
                            {% endif %}
                            <select name="unit" id="id_unit_new_failure" class="selectpicker" data-live-search="true"
                                data-width="100%" data-actions-box="true" data-actions-box="true">
                                {% for choice in form.unit %}
                                {{ choice }}
                                {% endfor %}
                            </select>
                            {% if form.unit.errors %}
                            <span class="field-helptext">{{ form.unit.help_text|safe }}</span>
                            {% endif %}
                        </div>

                        {% comment %} Select Related Data {% endcomment %}

                        {% comment %} Select Related DIG {% endcomment %}
                        <div class="col-3" id="select_related_dig_connection" style="display: none;">
                            <label
                                class="field-label{% if form.related_dig_connection.field.required %} field-required{% endif %}"
                                for="{{ form.related_dig_connection.name }}">{{ form.related_dig_connection.label }}:</label>
                            {% if form.related_dig_connection.errors %}
                            <span class="field-error">{{ form.related_dig_connection.errors }}</span>
                            {% endif %}
                            <select name="related_dig_connection" id="id_related_dig_connection_new_failure" class="selectpicker"
                                data-live-search="true" data-width="100%" data-actions-box="true"
                                data-actions-box="true">
                            </select>
                            <span class="field-helptext">{{ form.related_dig_connection.help_text|safe }}</span>
                        </div>

                        {% comment %} EPSAD DIGITAL CONNECTIONS {% endcomment %}
                        <div class="col-3" id="select_epsad_choice" style="display: none;" >
                                <label class="form-check-inline">
                                    <input class="form-check-input" type="radio" name="epsad_choice" id="id_epsad_internal_choice" value="epsad_internal">
                                    Εσωτερικές:
                                </label>
                                <label class="form-check-inline">
                                    <input class="form-check-input" type="radio" name="epsad_choice" id="id_epsad_external_choice" value="epsad_external">
                                    Εξωκείμενες:
                                </label>
                            <div id="select_epsad_internal" style="display: none;">
                                {% if form.related_dig_connection.errors %}
                                <span class="field-error">{{ form.related_dig_connection.errors }}</span>
                                {% endif %}
                                <select name="related_dig_connection" id="id_related_epsad_internal_new_failure" class="selectpicker"
                                    data-live-search="true" data-width="100%" data-actions-box="true"
                                    data-actions-box="true">
                                </select>
                                <span class="field-helptext">{{ form.related_dig_connection.help_text|safe }}</span>
                            </div>
                            <div id="select_epsad_external" style="display: none;">
                                {% if form.related_dig_connection.errors %}
                                <span class="field-error">{{ form.related_dig_connection.errors }}</span>
                                {% endif %}
                                <select name="related_dig_connection" id="id_related_epsad_external_new_failure" class="selectpicker"
                                    data-live-search="true" data-width="100%" data-actions-box="true"
                                    data-actions-box="true">
                                </select>
                                <span class="field-helptext">{{ form.related_dig_connection.help_text|safe }}</span>
                            </div>
                        </div>
                        {% comment %} END OF EPSAD DIGITAL CONNECTIONS {% endcomment %}

                        {% comment %} Select Related Pyrseia {% endcomment %}
                        <div class="col-3" id="select_related_pyrseia_server" style="display: none;">
                            <label
                                class="field-label{% if form.related_pyrseia_server.field.required %} field-required{% endif %}"
                                for="{{ form.related_pyrseia_server.name }}">{{ form.related_pyrseia_server.label }}:</label>
                            {% if form.related_pyrseia_server.errors %}
                            <span class="field-error">{{ form.related_pyrseia_server.errors }}</span>
                            {% endif %}
                            <select name="related_pyrseia_server" id="id_related_pyrseia_server_new_failure" class="selectpicker"
                                data-live-search="true" data-width="100%" data-actions-box="true">
                            </select>
                            <span class="field-helptext">{{ form.related_pyrseia_server.help_text|safe }}</span>
                        </div>

                        {% comment %} Select Related Broadband {% endcomment %}
                        <div class="col-3" id="select_related_broadband_transceiver" style="display: none;">
                            <label
                                class="field-label{% if form.related_broadband_transceiver.field.required %} field-required{% endif %}"
                                for="{{ form.related_broadband_transceiver.name }}">{{ form.related_broadband_transceiver.label }}:</label>
                            {% if form.related_broadband_transceiver.errors %}
                            <span class="field-error">{{ form.related_broadband_transceiver.errors }}</span>
                            {% endif %}
                            <select multiple name="related_broadband_transceiver" id="id_related_broadband_transceiver_new_failure" class="selectpicker"
                                data-live-search="true" data-width="100%" data-actions-box="true"
                                data-actions-box="true">
                            </select>
                            <span class="field-helptext">{{ form.related_broadband_transceiver.help_text|safe }}</span>
                        </div>

                        {% comment %} Select Related Satellite {% endcomment %}
                        <div class="col-3" id="select_related_satellite_node" style="display: none;">
                            <label
                                class="field-label{% if form.related_satellite_node.field.required %} field-required{% endif %}"
                                for="{{ form.related_satellite_node.name }}">{{ form.related_satellite_node.label }}:</label>
                            {% if form.related_satellite_node.errors %}
                            <span class="field-error">{{ form.related_satellite_node.errors }}</span>
                            {% endif %}
                            <select name="related_satellite_node" id="id_related_satellite_node_new_failure" class="selectpicker"
                                data-live-search="true" data-width="100%" data-actions-box="true"
                                data-actions-box="true">
                            </select>
                            <span class="field-helptext">{{ form.related_satellite_node.help_text|safe }}</span>
                        </div>

                        {% comment %} Select Related Harp {% endcomment %}
                        <div class="col-3" id="select_related_harp_correspondent" style="display: none;">
                            <label
                                class="field-label{% if form.related_harp_correspondent.field.required %} field-required{% endif %}"
                                for="{{ form.related_harp_correspondent.correspondent }}">{{ form.related_harp_correspondent.label }}:</label>
                            {% if form.related_harp_correspondent.errors %}
                            <span class="field-error">{{ form.related_harp_correspondent.errors }}</span>
                            {% endif %}
                            <select name="related_harp_correspondent" id="id_related_harp_correspondent_new_failure" class="selectpicker"
                                data-live-search="true" data-width="100%" data-actions-box="true"
                                data-actions-box="true">
                            </select>
                            <span class="field-helptext">{{ form.related_harp_correspondent.help_text|safe }}</span>
                        </div>


                        <div class="col-3" id="select_hermes_choice" style="display: none;" >
                                <label class="form-check-inline">
                                    <input class="form-check-input" type="radio" name="hermes_choice" id="id_hermes_node_choice" value="hermes_node">
                                    {{ form.related_hermes_node.label }}:
                                </label>
                                <label class="form-check-inline">
                                    <input class="form-check-input" type="radio" name="hermes_choice" id="id_hermes_connection_choice" value="hermes_connection">
                                    {{ form.related_hermes_connection.label }}:
                                </label>
                            <div id="select_related_hermes_node" style="display: none;">
                                {% if form.related_hermes_node.errors %}
                                <span class="field-error">{{ form.related_hermes_node.errors }}</span>
                                {% endif %}
                                <select name="related_hermes_node" id="id_related_hermes_node_new_failure" class="selectpicker"
                                    data-live-search="true" data-width="100%" data-actions-box="true"
                                    data-actions-box="true">
                                </select>
                                <span class="field-helptext">{{ form.related_hermes_node.help_text|safe }}</span>
                            </div>
                            <div id="select_related_hermes_connection" style="display: none;">
                                {% if form.related_hermes_connection.errors %}
                                <span class="field-error">{{ form.related_hermes_connection.errors }}</span>
                                {% endif %}
                                <select name="related_hermes_connection" id="id_related_hermes_connection_new_failure" class="selectpicker"
                                    data-live-search="true" data-width="100%" data-actions-box="true"
                                    data-actions-box="true">
                                </select>
                                <span class="field-helptext">{{ form.related_hermes_connection.help_text|safe }}</span>
                            </div>
                        </div>


                    </div>
                

                    {% comment %} Failure occurred date {% endcomment %}
                    <div class="form-group row">
                        <div class="form-inline col-12">
                            <div id="style_date_occurred_label_new_failure">
                                {{form.date_occurred|as_crispy_field}}
                            </div>
                            {% if form.date_occurred.errors %}
                            <span class="field-helptext">{{ form.date_occurred.help_text|safe }}</span>
                            {% endif %}
                        </div>
                    </div>

                    {% comment %} Submitter Rank - Name {% endcomment %}
                    <div class="form-group row">
                        <div class="form-inline col-4">
                            <label class="field-label{% if form.submitter_rank.field.required %} field-required{% endif %} "
                                for="{{ form.submitter_rank.name }}">
                                {{ form.submitter_rank.label }}:
                            </label>
                            {% if form.submitter_rank.errors %}
                            <span class="field-error">{{ form.submitter_rank.errors }}</span>
                            {% endif %}
                            {{form.submitter_rank}}
                            {% if form.submitter_rank.errors %}
                            <span class="field-helptext">{{ form.submitter_rank.help_text|safe }}</span>
                            {% endif %}
                        </div>
                        <div class="form-inline col-8 uppercase-input">
                            <label
                                class="field-label{% if form.submitter_name.field.required %} field-required{% endif %}"
                                for="{{ form.submitter_name.name }}">{{ form.submitter_name.label }}:</label>
                            {% if form.submitter_name.errors %}
                            <span class="field-error">{{ form.submitter_name.errors }}</span>
                            {% endif %}
                            {{form.submitter_name}}
                            {% if form.submitter_name.errors %}
                            <span class="field-helptext">{{ form.submitter_name.help_text|safe }}</span>
                            {% endif %}
                        </div>
                    </div>

                    {% comment %} Contact {% endcomment %}
                    <div class="form-group row">
                        {% comment %} Primary Phone {% endcomment %}
                        <div class="form-inline col-6">
                            <label
                                class="field-label{% if form.primary_phone.field.required %} field-required{% endif %}"
                                for="{{ form.primary_phone.name }}">{{ form.primary_phone.label }}:</label>
                            {% if form.primary_phone.errors %}
                            <span class="field-error">{{ form.primary_phone.errors }}</span>
                            {% endif %}
                            {{form.primary_phone}}
                            {% if form.primary_phone.errors %}
                            <span class="field-helptext">{{ form.primary_phone.help_text|safe }}</span>
                            {% endif %}
                        </div>

                        <div class="form-inline col-6">
                            <label
                                class="field-label{% if form.secondary_phone.field.required %} field-required{% endif %}"
                                for="{{ form.secondary_phone.name }}">{{ form.secondary_phone.label }}:</label>
                            {% if form.secondary_phone.errors %}
                            <span class="field-error">{{ form.secondary_phone.errors }}</span>
                            {% endif %}
                            {{form.secondary_phone}}
                            {% if form.secondary_phone.errors %}
                            <span class="field-helptext">{{ form.secondary_phone.help_text|safe }}</span>
                            {% endif %}
                        </div>
                        
                    </div>

                    {% comment %} Attach File {% endcomment %}
                    <div class="form-group row">
                        <div class="col-12">
                            <label
                                class="field-label{% if form.attached_file.field.required %} field-required{% endif %}"
                                for="{{ form.attached_file.name }}">{{ form.attached_file.label }}:</label>
                            {% if form.attached_file.errors %}<span
                                class="field-error">{{ form.attached_file.errors }}</span>{% endif %}
                            {{form.attached_file}}
                            {% if form.attached_file.help_text %}<span
                                class="field-helptext">{{ form.attached_file.help_text|safe }}</span>{% endif %}
                        </div>
                    </div>
                    <script>  
                        function checkMeans(){
                                if(document.getElementById("id_means_new_failure").selectedIndex == 1){
                                    alert("Παρακαλώ επιλέξτε επικοινωνιακό σύστημα");
                                    return false;
                                }
                            }       
                    </script>
                    <button class="btn btn-primary btn-user btn-block" id='submitBtn' form="new_failure_form" type='submit' > Υποβολή </button>

                </form>
            </div>
        </div>
    </div>

</div>

{% endblock %}

{% endblock %}