{% extends 'base.html' %}

{% load static %}
{% load crispy_forms_tags %}
{% load auth_extras %}

{% block page_content %}

{% block title %}
{% if form.instance|can_edit:user %}
<h1 class="h3 mb-0 text-gray-800"> Επεξεργασία Βλάβης </h1>
{% else %}
<h1 class="h3 mb-0 text-gray-800"> Επισκόπηση Βλάβης </h1>
{% endif %}
{% endblock %}

{% block content %}

<!-- Content Row -->
<div class="row">

  <div class="col-xl-8 col-lg-7">
    <div class="card shadow mb-4">
      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary"> Βλάβη {{form.number.value}}</h6>
      </div>
      <div class="card-body border-left-primary uppercase-input">
        <form method='POST' action="{% url 'failure_single' form.instance.id %}" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form.description|as_crispy_field }}
          {{ form.solution|as_crispy_field }}
          {{ form.unit|as_crispy_field }}
                       
          {{ form.means|as_crispy_field }}
          {{ form.failure_type|as_crispy_field }}
          {% if form.related_dig_connection %}
            {{ form.related_dig_connection|as_crispy_field }}
          {% comment %} because related_hermes_node+connection seem to always be part of the POST request
            creating the failure, use the .value method to check if a value was selected for them {% endcomment %}
          {% elif form.related_hermes_node.value %}
            {{ form.related_hermes_node|as_crispy_field }}
          {% elif form.related_hermes_connection.value %}
            {{ form.related_hermes_connection|as_crispy_field }}
          {% elif form.related_pyrseia_server %}
            {{ form.related_pyrseia_server|as_crispy_field }}
          {% elif form.related_broadband_transceiver %}
            <div class="form-group">
              <label class="" for="">
                {{ form.related_broadband_transceiver.label }}
              </label>
              <select name="related_broadband_transceiver" multiple class="selectpicker form-control"
                data-live-search="true" data-width="100%" data-actions-box="true">
                {% for choice in form.related_broadband_transceiver %}
                {{ choice }}
                {% endfor %}
              </select>
            </div>
          {% elif form.related_satellite_node %}
            {{ form.related_satellite_node|as_crispy_field }}
          {% elif form.related_harp_correspondent %}
            {{ form.related_harp_correspondent|as_crispy_field }}
          {% endif %}
          {{form.date_occurred|as_crispy_field}}
          {% if not user.is_simple_user %}
          {{ form.status|as_crispy_field }}
          {% endif %}
          {{ form.assigned_dispatcher|as_crispy_field }}
          {{ form.attached_file|as_crispy_field }}
          {{ form.primary_phone|as_crispy_field }}
          {{ form.secondary_phone|as_crispy_field }}
        {% if form.instance|can_edit:user %}
          <div class="d-flex justify-content-around">
        <a class="btn btn-default btn-user btn-block" href="{% url 'failure_single' form.instance.id %}">ΑΚΥΡΩΣΗ</a>
          <input type="hidden" name="_method" value="put" />
          <input class="btn btn-primary btn-user btn-block" id='submitBtn' type='submit' value="Ανανέωση" />
          </div>
        </form>
        {% else %}
        <a class="btn btn-default btn-user btn-block" href="{% url 'failure_single' form.instance.id %}">ΑΚΥΡΩΣΗ</a>          
        </form>
        {% endif %}
      </div>
    </div>
  </div>



  {% endblock %}


  {% endblock %}